<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: flexseo.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: flexseo.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

var _ = require('underscore');
var cheerio = require('cheerio');
var when = require('when');

var Rule = require("./rule");

/**
 * Create a SEO defect detector
 * @constructor
 * @param {object} option - used to configure pre-defined rules.
 */
function Flexseo(option) {

  // pre-defined SEO rules
  var default_option = {
    enableImgTagDefect: true,
    enableATagDefect: true,
    enableHeadTagDefect: true,
    enableStrongTagDefect: true,
    enableH1TagDefect: true
  };

  this.option = _.extendOwn(default_option, option);

  this.input = null;
  this.output = null;
  this.dom = null;
  this.rules = [];
}

/**
 * Setup input method
 * @param {object} input - used to feed in HTML file source
 */
Flexseo.prototype.setInput = function(input){
  this.input = input;
}

/**
 * Setup output method
 * @param {object} output - used to represent SEO defect result
 */
Flexseo.prototype.setOutput = function(output){
  this.output = output;
}

/**
 * Add a customized rule
 * @param {object} newRule - used to register a custom rule
 */
Flexseo.prototype.addRule = function(newRule){
  if(typeof newRule !== 'function') {
    console.log("invalid rule object");
    return;
  }
  this.rules.push(newRule);
}

/**
 * Start to detect SEO defects
 */
Flexseo.prototype.detectSEO = function(){
  var deferred = when.defer();
  
  if (this.option.enableImgTagDefect)
    this.rules.push(Rule.detectCountWithoutTagWithAttribute("", "img", "alt"));
  if (this.option.enableATagDefect)
    this.rules.push(Rule.detectCountWithoutTagWithAttribute("", "a", "rel"));
  if (this.option.enableHeadTagDefect){
    this.rules.push(Rule.detectExistTag("head", "title"));
    this.rules.push(Rule.detectExistTagWithAttributeValue("head", "meta", "name", "description"));
    this.rules.push(Rule.detectExistTagWithAttributeValue("head", "meta", "name", "keywords"));    
  }
  if (this.option.enableStrongTagDefect)
    this.rules.push(Rule.detectLimitOfTagCount("", "strong", 15));
  if (this.option.enableH1TagDefect)
    this.rules.push(Rule.detectLimitOfTagCount("", "h1", 1));

  if (_.isNull(this.input))
    deferred.reject(new Error('invalid input object'));
  else
    this.input().done(
      (result) => {
          this.dom = cheerio.load(result);

          _.each(this.rules, (rule)=>{
            var result = rule(this.dom);
            if (!_.isNull(this.output) &amp;&amp; result.defect) 
              this.output(result.defect);
          });

          deferred.resolve("finish all SEO defects scan");
      },
      (err) => {
          deferred.reject(err);
      }
    );

  return deferred.promise;
}

module.exports = Flexseo;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Rule.html">Rule</a></li></ul><h3>Classes</h3><ul><li><a href="Flexseo.html">Flexseo</a></li><li><a href="Input.html">Input</a></li><li><a href="Output.html">Output</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Mar 03 2018 11:49:30 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
